{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load widget_tweaks %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/detail.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
{% endblock css %}

{% block body %}
<div class="card-detail">
  <div class="card-detail-top">
    <div class="card-detail-image-box">
      <img class="card-detail-image" src="{{ card_img }}" alt="">
    </div>
    <p class="card-detail-brand">{{ card_brand }}</p>
    <p class="card-detail-name">{{ card_name }}</p>
    {% if request.user.is_authenticated %}
      {% if request.user not in user_card_compare %}
      <button type="button" id="card-com-add" class="card-compare card-compare-pos" data-cardcom-id={{ card_id }}>비교함에 추가</button>
      {% else %}
      <button type="button" id="card-com-add" class="card-compare card-compare-neg" data-cardcom-id={{ card_id }}>비교함에서 꺼내기</button>
      {% endif %}
    {% endif %}
  </div>
</div>

<div class="card-detail-bnf1-all">
  <div class="card-detail-bnf1">
    {% if card_in_out_2 != None  %}
    <p class="card-detail-bnf1-inout">{{ card_in_out_1 }} / {{ card_in_out_2 }}</p>
    {% elif card_in_out_3 != None %}
    <p class="card-detail-bnf1-inout">{{ card_in_out_1 }} / {{ card_in_out_2 }} / {{ card_in_out_3 }}</p>
    {% else %}
    <p class="card-detail-bnf1-inout">{{ card_in_out_1 }}</p>
    {% endif %}
    <p class="card-detail-bnf1-record">{{ card_record }}</p>
    <div class="card-detail-card-overseas">
      <p class="card-detail-bnf1-overseas">{{ card_overseas }}</p>
    </div>
  </div>
  <div>
    {% if card_brand == "신한카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.shinhancard.com/pconts/html/main.html#utm_source=naver_pc&utm_medium=brandsearch_sa&utm_campaign=home_button">신한카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "BC 바로카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://paybooc.co.kr/mobile/BCBaroPlus.html?coCd=R005">BC 바로카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "BNK부산은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.busanbank.co.kr/ib20/mnu/FPMCRD122001001">BNK부산은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "DB금융투자" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://dhp.db-fi.com:8100/product/cma/viewProductCmaCardList.dhp">DB금융투자 사이트로 가기</a>
    </div>
    {% elif card_brand == "DGB대구은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.dgb.co.kr/fnc_ebz_sm_11010_card.act">DGB대구은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "IBK기업은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.ibk.co.kr/card/mainList.ibk">IBK기업은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "KB국민카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://card.kbcard.com/CMN/DVIEW/HOAMCXPRIZZC0002">KB국민카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "KB증권" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://m.kbsec.com/go.able?linkcd=et00101">KB증권 사이트로 가기</a>
    </div>
    {% elif card_brand == "KDB산업은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://smart.kdb.co.kr/mp/MHBMCA01N00.act">KDB산업은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "KG모빌리언스" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.mobilcard.co.kr/">KG모빌리언스 사이트로 가기</a>
    </div>
    {% elif card_brand == "MG새마을금고" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://mgcheck.kfcc.co.kr/pers/appl/persCdGuidList.do">MG새마을금고 사이트로 가기</a>
    </div>
    {% elif card_brand == "NH농협카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://card.nonghyup.com/IPCC01.menu">NH농협카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "SBI저축은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.sbisb.co.kr/IHPPRODcard0801l.web">SBI저축은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "SC제일은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.standardchartered.co.kr/np/kr/Intro.jsp">SC제일은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "Sh수협은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://suhyup-bank.com/">Sh수협은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "SK증권" %}
    <div class="card-detail-bnf1-btn">
      <a href="http://direct-sks.co.kr/">SK증권 사이트로 가기</a>
    </div>
    {% elif card_brand == "SSGPAY. CARD" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://card.ssgpay.com/">SSGPAY 사이트로 가기</a>
    </div>
    {% elif card_brand == "광주은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.kjbank.com/ib20/mnu/FPMCARD010000">광주은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "교보증권" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://m.iprovest.com/weblogic/CheckCardServlet/checkCard">교보증권 사이트로 가기</a>
    </div>
    {% elif card_brand == "다날" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.danalpay.com/service_introduction/creditcard_payment">다날 사이트로 가기</a>
    </div>
    {% elif card_brand == "롯데카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.lottecard.co.kr/app/LPMAIAA_V100.lc?referrer=https%3A%2F%2Fwww.google.com%2F">롯데카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "미래에셋증권" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://securities.miraeasset.com/">미래에셋증권 사이트로 가기</a>
    </div>
    {% elif card_brand == "삼성카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.samsungcard.com/personal/main/UHPPCO0101M0.jsp">삼성카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "신협" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://openbank.cu.co.kr/">신협 사이트로 가기</a>
    </div>
    {% elif card_brand == "씨티카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.citibank.co.kr/CrdMainCnts0100.act">씨티카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "아이오로라" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.i-aurora.kr/">아이오로라 사이트로 가기</a>
    </div>
    {% elif card_brand == "엔에이치엔페이코" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://company.payco.com/">엔에이치엔페이코 사이트로 가기</a>
    </div>
    {% elif card_brand == "우리카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://pc.wooricard.com/dcpc/main.do">우리카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "우체국" %}
    <div class="card-detail-bnf1-btn">
      <a href="http://m.epostbank.kr/pbcd0100.screen">우체국 사이트로 가기</a>
    </div>
    {% elif card_brand == "유안타증권" %}
    <div class="card-detail-bnf1-btn">
      <a href="">유안타증권 사이트로 가기</a>
    </div>
    {% elif card_brand == "유진투자증권" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.myasset.com/extern/eventtotal/views/dmstcStock.jsp?mkt=keyword_naverpc_tradar&gclid=Cj0KCQiA-JacBhC0ARIsAIxybyOmVA_CPrQ2u4DS3DMLgiyiAho-gvRYhQ-X3pL9GJpUt9e7o857u80aAmIXEALw_wcB">유진투자증권 사이트로 가기</a>
    </div>
    {% elif card_brand == "전북은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.jbbank.co.kr/">전북은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "제주은행" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.e-jejubank.com/JeJuBankInfo.do">제주은행 사이트로 가기</a>
    </div>
    {% elif card_brand == "차이" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://chai.finance/card/">차이 사이트로 가기</a>
    </div>
    {% elif card_brand == "카카오뱅크" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.kakaobank.com/">카카오뱅크 사이트로 가기</a>
    </div>
    {% elif card_brand == "케이뱅크" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.kbanknow.com/ib20/mnu/PBKMAN000000">케이뱅크 사이트로 가기</a>
    </div>
    {% elif card_brand == "코나카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.konacard.co.kr/">코나카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "토스" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://toss.im/">토스 사이트로 가기</a>
    </div>
    {% elif card_brand == "토스뱅크" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.tossbank.com/">토스뱅크 사이트로 가기</a>
    </div>
    {% elif card_brand == "트래블월렛" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.travel-wallet.com/">트래블월렛 사이트로 가기</a>
    </div>
    {% elif card_brand == "핀크카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="">핀크카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "핀트" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.fint.co.kr/">핀트 사이트로 가기</a>
    </div>
    {% elif card_brand == "하나카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.hanacard.co.kr/OPH30000000N.web?_frame=no&schID=pcd&mID=OPH30000000C&">하나카드 사이트로 가기</a>
    </div>
    {% elif card_brand == "한국투자증권" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://securities.koreainvestment.com/main/Main.jsp">한국투자증권 사이트로 가기</a>
    </div>
    {% elif card_brand == "한패스" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.hanpass.com/card">한패스 사이트로 가기</a>
    </div>
    {% elif card_brand == "현대백화점" %}
    <div class="card-detail-bnf1-btn">
      <a href="http://www.ehyundai.com/newPortal/card/main.do">현대백화점 사이트로 가기</a>
    </div>
    {% elif card_brand == "현대카드" %}
    <div class="card-detail-bnf1-btn">
      <a href="https://www.hyundaicard.com/index.jsp">현대카드 사이트로 가기</a>
    </div>
    {% endif %}
  </div>
</div>

{% comment %} 튜플 (benefit queryset, benefit category) {% endcomment %}
<div class="card-detail-bnf2 text-center">
  <div class="container">
    <p class="card-detail-bnf2-title">주요 혜택</p>
    <div class="row d-flex justify-content-center">
      {% for benefit in benefits %}
      <div class="card-detail-card-group col-sm-6 col-md-6 col-lg-4 col-xl-3">
        <div class="card-detail-card-all">
          <div class="card-detail-card-cards">
            <div class="card-detail-card-content">
              <div class="card-detail-card">
                {% if benefit.1 == '혜택' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">loyalty</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '스포츠' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">sports_soccer</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '영화' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">movie</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '문화' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">theater_comedy</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '여행' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">luggage</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '교통' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">directions_bus</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '페이' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">add_card</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '포인트' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">paid</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '통신사' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">phone_android</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '쇼핑' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">shopping_bag</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '교육' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">school</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '비즈니스' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">business_center</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '생활' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">home</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '공과금' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">assured_workload</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '카드' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">credit_card</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '어플' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">touch_app</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '애완동물' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">pets</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '자동차' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">directions_car</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '카페' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">coffee</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '건강' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">stethoscope</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '보험' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">account_balance</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '음식' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">ramen_dining</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '금융' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">savings</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '뷰티' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">diversity_1</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '항공' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">flight_takeoff</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '패션' %}
                <i class="fa-regular fa-shirt"></i>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '프리미엄' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">diamond</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '지역' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">pin_drop</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '기타' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">more</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% elif benefit.1 == '유의사항' %}
                <span class="material-symbols-outlined" style="margin-bottom:1rem; font-size:4.5rem;">help_center</span>
                <p class="card-detail-bnf2-name">{{ benefit.0.bnf_name }}</p>
                {% endif %}
              </div>
            </div>
            <div class="card-detail-back d-flex flex-column align-items-center justify-content-center">
              <p style="font-size: 1.2rem; font-weight:bold; color:black;">{{ benefit.0.bnf_content }}</p>
              <!-- Modal 버튼 -->
              <button type="button" class="btn-bnf" data-bs-toggle="modal" data-bs-target="#exampleModal-{{ forloop.counter0 }}">
                혜택 자세히 보기
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Modal -->
      <div class="modal fade" id="exampleModal-{{ forloop.counter0 }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel" style="color:black; font-weight:bold;">{{ benefit.0.bnf_name }}</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <h3 style=" margin-bottom: 1.5rem; font-size: 1.2rem; color:#666e7894; text-align:left;">{{ benefit.0.bnf_content }}</h3>
              <div class="linebreaks">
                {{ benefit.0.bnf_detail|linebreaks }}
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
<!--후기 작성-->
<div style='padding-bottom:5rem; background-color: #ebebeb;'>
  <div class="detail-comment-create container">
    <p class="detail-comment-title">카드 후기</p>
    <form action="{% url 'card:comment' card_id %}" method="POST" class="detail-comment-form" data-card-id="{{ card_id }}">
      <div class="detail-comment-input-box">
        {% csrf_token %}
        <div>
          <p style="color:#757d89;">후기 작성</p>
          {% render_field detail_comment_form.content class="detail-comment-write form-control"  placeholder="후기를 작성해주세요" add_required_class="is-required"%}
        </div>
        <div style="margin-top: 1rem;">
          <p style="color:#757d89;">카드 평점</p>
          {% render_field detail_comment_form.rate class="detail-comment-rate form-control" placeholder="만족도를 선택해주세요" add_required_class="is-required" %}
        </div>
      </div>
      <input class="btn-detail-comment" type="submit" value="Submit">
    </form>
  </div>
  <div style="background-color:#ebebeb;">
    <div class="detail-comment-box container">
      {% for comment in detail_comments %}
      <div class="detail-comment">
        <div class="detail-comment-detail">
          <div class="d-flex flex-column">
            <p class="detail-comment-user">{{ comment.user }}</p>
            {% if request.user == comment.user %}
            <div style="margin-top:10px; display:flex">
              <p class="detail-comment-update" onclick="comment_update(this)" id="okBtn-{{ comment.pk }}" data-cardup-id="{{ card_id }}" data-commentup-id="{{ comment.pk }}">수정</p>
              <p class="detail-comment-delete" onclick="comment_delete(this)" id="comment-delete-{{ comment.pk }}" data-carddel-id="{{ card_id }}" data-commentdel-id="{{ comment.pk }}" style="margin-left: 1.5rem;">삭제</p>
            </div>
            {% endif %}
          </div>
          <div class="detail-comment-review">
            <div class="detail-comment-review-okBtn-{{ comment.pk }} review-comment-update-{{ comment.pk }}" style="display:block;">
              <p class="detail-comment-rate">{{ comment.get_rate_display }}</p>
              <p class="detail-comment-content">{{ comment.content }}</p>
              <p class="detail-comment-time">{{ comment.updated_at }}</p>
            </div>
            {% if request.user == comment.user %}
            <form class="comment-update-form form-comment-update-{{ comment.pk }}" id="form-comment-update-okBtn-{{ comment.pk }}" action="{% url 'card:comment_update' card_id comment.pk %}" method="post" style="display:none">
              {% csrf_token %}
              <div class="comment-update-form-style">
                <select class="comment-update-rate" id="comment-update-rate-{{ comment.pk }}" value="{{ comment.rate }}">
                  <option selected value="{{ comment.rate }}">{{ comment.get_rate_display }}</option>
                  <option value="1">⭐</option>
                  <option value="2">⭐⭐</option>
                  <option value="3">⭐⭐⭐</option>
                  <option value="4">⭐⭐⭐⭐</option>
                  <option value="5">⭐⭐⭐⭐⭐</option>
                </select>
                <input class="comment-update-content" id="comment-update-input-{{ comment.pk }}" type="text" value="{{ comment.content }}">
                <div class="d-flex">
                  <p class="comment-control-update" onclick="comment_update_ok(this)" id="comment-update-ok-{{ comment.pk }}" data-cardup-id="{{ card_id }}" data-commentup-id="{{ comment.pk }}">수정 완료</p>
                  <p class="comment-control-update-exit ms-3" onclick="comment_update_exit(this)" id="comment-update-{{ comment.pk }}">취소</p>
                </div>
              </div>
            </form>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  // 카드 디테일 세로로 바꾸기
  function cardDetailVertical() {
    let cardImage = document.querySelector('.card-detail-image')
    let imageWidth = cardImage.width
    let imageHeight = cardImage.height

    if (imageWidth > imageHeight) {
      console.log('회전하기!')
      cardImage.style.width = '300px';
      cardImage.style.height = '190px';
      cardImage.classList.add('rotate90');
    } else {
      cardImage.style.width = '190px';
      cardImage.style.height = '300px';
    }
  }

  cardDetailVertical()

  // 카드 비교에 넣기
  const cardCompare = document.querySelector("#card-com-add")

  cardCompare.addEventListener('click', function(event) {
    console.log(event.target.dataset.cardcomId)
    axios({
      method: 'get',
      url: `/card/bookmark/${event.target.dataset.cardcomId}/`
    }) .then (response => {

      function cardModalVertical() {
      let modalCardImage = document.querySelectorAll('.compare-bag-card-image')
      console.log(modalCardImage)

      for (let i = 0 ; i < modalCardImage.length ; i ++) {
    
        if (modalCardImage[i].width > modalCardImage[i].height) {
          console.log('회전하기!')
          modalCardImage[i].style.width = '160px';
          modalCardImage[i].style.height = '100px';
          modalCardImage[i].classList.add('rotate90');
        } else {
          modalCardImage[i].style.width = '100px';
          modalCardImage[i].style.height = '160px';
        }
      }
    }

      compareModal = document.querySelector("#card-modal-body")
      compareModal.textContent = ""
      compareBag = response.data.compareBag

      console.log(compareBag[2])

      function compareModalInsert() {
        if (compareBag.length === 3) {
          // 모달에 비동기로 카드 추가하기
          compareModal.insertAdjacentHTML('beforeend', `
          <div class="row">
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <img class="compare-bag-card-image" src="${ compareBag[0].cardImg }" alt="" srcset="">
              </div>
              <div class="compare-bag-overlay">
                <a class="compare-bag-overlay-word" href="/card/detail/${ compareBag[0].cardId}/">카드<br>보러 가기</a>
              </div>
              <p class="compare-bag-card-name" style="color:black;"> ${ compareBag[0].cardName } </p>
            </div>
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <img class="compare-bag-card-image" src="${ compareBag[1].cardImg }" alt="" srcset="">
              </div>
              <div class="compare-bag-overlay">
                <a class="compare-bag-overlay-word" href="/card/detail/${ compareBag[1].cardId}/">카드<br>보러 가기</a>
              </div>
              <p class="compare-bag-card-name" style="color:black;"> ${ compareBag[1].cardName } </p>
            </div>
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <img class="compare-bag-card-image" src="${ compareBag[2].cardImg }" alt="" srcset="">
              </div>
              <div class="compare-bag-overlay">
                <a class="compare-bag-overlay-word" href="/card/detail/${ compareBag[2].cardId}/">카드<br>보러 가기</a>
              </div>
              <p class="compare-bag-card-name" style="color:black;"> ${ compareBag[2].cardName } </p>
            </div>
          </div>
          `)} else if (compareBag.length === 2) {
          // 모달에 비동기로 카드 추가하기
          compareModal.insertAdjacentHTML('beforeend', `
          <div class="row">
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <img class="compare-bag-card-image" src="${ compareBag[0].cardImg }" alt="" srcset="">
              </div>
              <div class="compare-bag-overlay">
                <a class="compare-bag-overlay-word" href="/card/detail/${ compareBag[0].cardId}/">카드<br>보러 가기</a>
              </div>
              <p class="compare-bag-card-name" style="color:black;"> ${ compareBag[0].cardName } </p>
            </div>
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <img class="compare-bag-card-image" src="${ compareBag[1].cardImg }" alt="" srcset="">
              </div>
              <div class="compare-bag-overlay">
                <a class="compare-bag-overlay-word" href="/card/detail/${ compareBag[1].cardId}/">카드<br>보러 가기</a>
              </div>
              <p class="compare-bag-card-name" style="color:black;"> ${ compareBag[1].cardName } </p>
            </div>
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <a class="compare-bag-card-search" href="/card/search/"><span class="material-symbols-outlined" style="font-size: 3rem; margin: 0;">add</span></a>
              </div>
            </div>
          </div>
          `)} else if (compareBag.length === 1) {
          // 모달에 비동기로 카드 추가하기
          compareModal.insertAdjacentHTML('beforeend', `
          <div class="row">
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <img class="compare-bag-card-image" src="${ compareBag[0].cardImg }" alt="" srcset="">
              </div>
              <div class="compare-bag-overlay">
                <a class="compare-bag-overlay-word" href="/card/detail/${ compareBag[0].cardId}/">카드<br>보러 가기</a>
              </div>
              <p class="compare-bag-card-name" style="color:black;"> ${ compareBag[0].cardName } </p>
            </div>
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <a class="compare-bag-card-search" href="/card/search/"><span class="material-symbols-outlined" style="font-size: 3rem; margin: 0;">add</span></a>
              </div>
            </div>
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <a class="compare-bag-card-search" href="/card/search/"><span class="material-symbols-outlined" style="font-size: 3rem; margin: 0;">add</span></a>
              </div>
            </div>
          </div>
          `)} else if (compareBag.length === 0) {
          // 모달에 비동기로 카드 추가하기
          compareModal.insertAdjacentHTML('beforeend', `
          <div class="row">
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <a class="compare-bag-card-search" href="/card/search/"><span class="material-symbols-outlined" style="font-size: 3rem; margin: 0;">add</span></a>
              </div>
            </div>
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <a class="compare-bag-card-search" href="/card/search/"><span class="material-symbols-outlined" style="font-size: 3rem; margin: 0;">add</span></a>
              </div>
            </div>
            <div class="col compare-bag-card">
              <div class="compare-bag-card-image-box">
                <a class="compare-bag-card-search" href="/card/search/"><span class="material-symbols-outlined" style="font-size: 3rem; margin: 0;">add</span></a>
              </div>
            </div>
          </div>
          `)}
        }

      if (response.data.notWork === true) {   
        if (response.data.compareAdd === true) {
          event.target.classList.remove(".card-compare-pos")
          event.target.classList.add(".card-compare-neg")
          cardCompare.innerText = "비교함에서 꺼내기"
          event.target.style.color = "#fd7373"
          compareModalInsert()
          cardModalVertical()
          
        } else {
          event.target.classList.remove(".card-compare-neg")
          event.target.classList.add(".card-compare-pos")
          cardCompare.innerText = "비교함에 추가"
          event.target.style.color = "#738ffd"
          compareModalInsert()
          cardModalVertical()
          
        }
      } else {
        alert('카드 3개까지 추가가 가능합니다! 비교함에서 카드를 꺼내주세요 ㅜ.ㅜ')
        compareModalInsert()
        cardModalVertical()
      }
    })
  })




  // 카드 베너 가로로 바꾸기
  {% comment %} let bannerCardImage = document.querySelectorAll('.card-detail-banner-card-image')

  for (let i = 0; i < 10; i++) {
      if (bannerCardImage[i].height > bannerCardImage[i].width) {
        console.log('회전하기!')
        bannerCardImage[i].style.width = '210px';
        bannerCardImage[i].style.height = '350px';
        bannerCardImage[i].style.borderRadius = '15px';
        bannerCardImage[i].classList.add('banner-rotate90')
      } else {
        bannerCardImage[i].style.width = '350px';
        bannerCardImage[i].style.height = '210px';
        bannerCardImage[i].style.borderRadius = '15px';
      }
    } {% endcomment %}

  // 댓글 생성 비동기
  const commentForm = document.querySelector('.detail-comment-form') 
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value

  commentForm.addEventListener('submit', function(event) {
    event.preventDefault();
    axios({
      method: 'post',
      url: `/card/comment/${event.target.dataset.cardId}/`,
      headers: {
        'X-CSRFToken': csrftoken
      },
      data: new FormData(commentForm)
    }).then(response => {
      
      const comments = document.querySelector(".detail-comment-box")
      comments.textContent= ""
      const commentData = response.data.commentData
      const user = response.data.user
      const cardId = response.data.cardId

      for (i = 0 ; i < commentData.length; i++) {

        let rate = commentData[i].rate

        if (rate == '1') {
          rate = '⭐'
        } else if (rate == '2') {
          rate = '⭐⭐'
        } else if (rate == '3') {
          rate = '⭐⭐⭐'
        } else if (rate == '4') {
          rate = '⭐⭐⭐⭐'
        } else {
          rate = '⭐⭐⭐⭐⭐'
        }

        // 댓글을 저장한 유저가 댓글의 user_id와 같을 때
        if (user === commentData[i].user_id) {
        comments.insertAdjacentHTML('beforeend', `
        <div class="detail-comment">
          <div class="detail-comment-detail">
            <div class="d-flex flex-column">
              <p class="detail-comment-user">${ commentData[i].userName }</p>
              <div style="margin-top:10px; display:flex">
                <p class="detail-comment-update" onclick="comment_update(this)" id="okBtn-${ commentData[i].comment_id }" data-cardup-id="${ cardId }" data-commentup-id="${ commentData[i].comment_id }">수정</p>
                <p class="detail-comment-delete" onclick="comment_delete(this)" id="comment-delete-${ commentData[i].comment_id }" data-carddel-id="${ cardId }" data-commentdel-id="${ commentData[i].comment_id }" style="margin-left: 1.5rem;">삭제</p>
              </div>
            </div>
            <div class="detail-comment-review">
              <div class="detail-comment-review-okBtn-${ commentData[i].comment_id } review-comment-update-${ commentData[i].comment_id }" style="display:block;">
                <p class="detail-comment-rate">${ rate }</p>
                <p class="detail-comment-content">${ commentData[i].content }</p>
                <p class="detail-comment-time">${ commentData[i].update }</p>
              </div>
              <form class="comment-update-form form-comment-update-${ commentData[i].comment_id }" id="form-comment-update-okBtn-${ commentData[i].comment_id }" action="/card/comment_update/${ cardId }/${ commentData[i].comment_id }/" method="post" style="display:none">
                <div class="comment-update-form-style">
                  <select class="comment-update-rate" id="comment-update-rate-${ commentData[i].comment_id }" value="${ commentData[i].rate }">
                    <option selected value="${ commentData[i].rate }">${rate}</option>
                    <option value="1">⭐</option>
                    <option value="2">⭐⭐</option>
                    <option value="3">⭐⭐⭐</option>
                    <option value="4">⭐⭐⭐⭐</option>
                    <option value="5">⭐⭐⭐⭐⭐</option>
                  </select>
                  <input class="comment-update-content" id="comment-update-input-${ commentData[i].comment_id }" type="text" value="${ commentData[i].content }">
                  <div class="d-flex">
                    <p class="comment-control-update" onclick="comment_update_ok(this)" id="comment-update-ok-${ commentData[i].comment_id }" data-cardup-id="${ cardId }" data-commentup-id="${ commentData[i].comment_id }">수정 완료</p>
                    <p class="comment-control-update-exit ms-3" onclick="comment_update_exit(this)" id="comment-update-${ commentData[i].comment_id }">취소</p>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        `
        )} else {
          comments.insertAdjacentHTML('beforeend', `
          <div class="detail-comment">
            <div class="detail-comment-detail">
              <div class="d-flex flex-column">
                <p class="detail-comment-user">${ commentData[i].userName }</p>
              </div>
              <div class="detail-comment-review">
                <div class="detail-comment-review-okBtn-${ commentData[i].comment_id } review-comment-update-${ commentData[i].comment_id }" style="display:block;">
                  <p class="detail-comment-rate">${ rate }</p>
                  <p class="detail-comment-content">${ commentData[i].content }</p>
                  <p class="detail-comment-time">${ commentData[i].update }</p>
                </div>
              </div>
            </div>
          </div>
          `
          )
        }
      }
    })
    commentForm.reset()
  })

  // 댓글 삭제 비동기
  const comment_delete = (e) => {
    console.log(e.id)
    const comment_id = document.querySelector(`#${e.id}`).id

    axios({
      method: 'post',
      url: `/card/comment_delete/${event.target.dataset.carddelId}/${event.target.dataset.commentdelId}/`,
      headers: {
        'X-CSRFToken': csrftoken
      }
    }) .then(response => {
      console.log(response.data.cardId)
      console.log(response.data)
      const comments = document.querySelector(".detail-comment-box")
      comments.textContent= ""
      const commentData = response.data.commentData
      const user = response.data.user
      const cardId = response.data.cardId

      for (i = 0 ; i < commentData.length; i++) {

        let rate = commentData[i].rate

        if (rate == '1') {
          rate = '⭐'
        } else if (rate == '2') {
          rate = '⭐⭐'
        } else if (rate == '3') {
          rate = '⭐⭐⭐'
        } else if (rate == '4') {
          rate = '⭐⭐⭐⭐'
        } else {
          rate = '⭐⭐⭐⭐⭐'
        }

        if (user === commentData[i].user_id) {
        comments.insertAdjacentHTML('beforeend', `
        <div class="detail-comment">
          <div class="detail-comment-detail">
            <div class="d-flex flex-column">
              <p class="detail-comment-user">${ commentData[i].userName }</p>
              <div style="margin-top:10px; display:flex">
                <p class="detail-comment-update" onclick="comment_update(this)" id="okBtn-${ commentData[i].comment_id }" data-cardup-id="${ cardId }" data-commentup-id="${ commentData[i].comment_id }">수정</p>
                <p class="detail-comment-delete" onclick="comment_delete(this)" id="comment-delete-${ commentData[i].comment_id }" data-carddel-id="${ cardId }" data-commentdel-id="${ commentData[i].comment_id }" style="margin-left: 1.5rem;">삭제</p>
              </div>
            </div>
            <div class="detail-comment-review">
              <div class="detail-comment-review-okBtn-${ commentData[i].comment_id } review-comment-update-${ commentData[i].comment_id }" style="display:block;">
                <p class="detail-comment-rate">${ rate }</p>
                <p class="detail-comment-content">${ commentData[i].content }</p>
                <p class="detail-comment-time">${ commentData[i].update }</p>
              </div>
              <form class="comment-update-form form-comment-update-${ commentData[i].comment_id }" id="form-comment-update-okBtn-${ commentData[i].comment_id }" action="/card/comment_update/${ cardId }/${ commentData[i].comment_id }/" method="post" style="display:none">
                <div class="comment-update-form-style">
                  <select class="comment-update-rate" id="comment-update-rate-${ commentData[i].comment_id }" value="${ commentData[i].rate }">
                    <option selected value="${ commentData[i].rate }">${rate}</option>
                    <option value="1">⭐</option>
                    <option value="2">⭐⭐</option>
                    <option value="3">⭐⭐⭐</option>
                    <option value="4">⭐⭐⭐⭐</option>
                    <option value="5">⭐⭐⭐⭐⭐</option>
                  </select>
                  <input class="comment-update-content" id="comment-update-input-${ commentData[i].comment_id }" type="text" value="${ commentData[i].content }">
                  <div class="d-flex">
                    <p class="comment-control-update" onclick="comment_update_ok(this)" id="comment-update-ok-${ commentData[i].comment_id }" data-cardup-id="${ cardId }" data-commentup-id="${ commentData[i].comment_id }">수정 완료</p>
                    <p class="comment-control-update-exit ms-3" onclick="comment_update_exit(this)" id="comment-update-${ commentData[i].comment_id }">취소</p>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        `
        )} else {
          comments.insertAdjacentHTML('beforeend', `
          <div class="detail-comment">
            <div class="detail-comment-detail">
              <div class="d-flex flex-column">
                <p class="detail-comment-user">${ commentData[i].userName }</p>
              </div>
              <div class="detail-comment-review">
                <div class="detail-comment-review-okBtn-${ commentData[i].comment_id } review-comment-update-${ commentData[i].comment_id }" style="display:block;">
                  <p class="detail-comment-rate">${ rate }</p>
                  <p class="detail-comment-content">${ commentData[i].content }</p>
                  <p class="detail-comment-time">${ commentData[i].update }</p>
                </div>
              </div>
            </div>
          </div>
          `
          )
        }
      }
    })
  }

  const comment_update_ok = (e) => {
    const commentId = event.target.dataset.commentupId
    const cardId = event.target.dataset.cardupId
    const commentInput = document.querySelector(`#comment-update-input-${commentId}`)
    const rateInput = document.querySelector(`#comment-update-rate-${commentId}`)


    axios({
      method: 'post',
      url: `/card/comment_update/${ cardId }/${ commentId }/`,
      headers: {
        'X-CSRFToken': csrftoken
      },
      data: {
        'content': commentInput.value,
        'rate' : rateInput.value
      }
    }) .then(response => {
      const comments = document.querySelector(".detail-comment-box")
      comments.textContent= ""
      const commentData = response.data.commentData
      const user = response.data.user
      const cardId = response.data.cardId
      for (i = 0 ; i < commentData.length; i++) {

        let rate = commentData[i].rate

        if (rate == '1') {
          rate = '⭐'
        } else if (rate == '2') {
          rate = '⭐⭐'
        } else if (rate == '3') {
          rate = '⭐⭐⭐'
        } else if (rate == '4') {
          rate = '⭐⭐⭐⭐'
        } else {
          rate = '⭐⭐⭐⭐⭐'
        }

        if (user === commentData[i].user_id) {
        comments.insertAdjacentHTML('beforeend', `
        <div class="detail-comment">
          <div class="detail-comment-detail">
            <div class="d-flex flex-column">
              <p class="detail-comment-user">${ commentData[i].userName }</p>
              <div style="margin-top:10px; display:flex">
                <p class="detail-comment-update" onclick="comment_update(this)" id="okBtn-${ commentData[i].comment_id }" data-cardup-id="${ cardId }" data-commentup-id="${ commentData[i].comment_id }">수정</p>
                <p class="detail-comment-delete" onclick="comment_delete(this)" id="comment-delete-${ commentData[i].comment_id }" data-carddel-id="${ cardId }" data-commentdel-id="${ commentData[i].comment_id }" style="margin-left: 1.5rem;">삭제</p>
              </div>
            </div>
            <div class="detail-comment-review">
              <div class="detail-comment-review-okBtn-${ commentData[i].comment_id } review-comment-update-${ commentData[i].comment_id }" style="display:block;">
                <p class="detail-comment-rate">${ rate }</p>
                <p class="detail-comment-content">${ commentData[i].content }</p>
                <p class="detail-comment-time">${ commentData[i].update }</p>
              </div>
              <form class="comment-update-form form-comment-update-${ commentData[i].comment_id }" id="form-comment-update-okBtn-${ commentData[i].comment_id }" action="/card/comment_update/${ cardId }/${ commentData[i].comment_id }/" method="post" style="display:none">
                <div class="comment-update-form-style">
                  <select class="comment-update-rate" id="comment-update-rate-${ commentData[i].comment_id }" value="${ commentData[i].rate }">
                    <option selected value="${ commentData[i].rate }">${rate}</option>
                    <option value="1">⭐</option>
                    <option value="2">⭐⭐</option>
                    <option value="3">⭐⭐⭐</option>
                    <option value="4">⭐⭐⭐⭐</option>
                    <option value="5">⭐⭐⭐⭐⭐</option>
                  </select>
                  <input class="comment-update-content" id="comment-update-input-${ commentData[i].comment_id }" type="text" value="${ commentData[i].content }">
                  <div class="d-flex">
                    <p class="comment-control-update" onclick="comment_update_ok(this)" id="comment-update-ok-${ commentData[i].comment_id }" data-cardup-id="${ cardId }" data-commentup-id="${ commentData[i].comment_id }">수정 완료</p>
                    <p class="comment-control-update-exit ms-3" onclick="comment_update_exit(this)" id="comment-update-${ commentData[i].comment_id }">취소</p>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        `
        )} else {
          comments.insertAdjacentHTML('beforeend', `
          <div class="detail-comment">
            <div class="detail-comment-detail">
              <div class="d-flex flex-column">
                <p class="detail-comment-user">${ commentData[i].userName }</p>
              </div>
              <div class="detail-comment-review">
                <div class="detail-comment-review-okBtn-${ commentData[i].comment_id } review-comment-update-${ commentData[i].comment_id }" style="display:block;">
                  <p class="detail-comment-rate">${ rate }</p>
                  <p class="detail-comment-content">${ commentData[i].content }</p>
                  <p class="detail-comment-time">${ commentData[i].update }</p>
                </div>
              </div>
            </div>
          </div>
          `
          )
        }
      }
    })
  } 

  const comment_update = (e) => {
    const commentId = document.querySelector(`#${e.id}`).id
    // 수정을 클릭하면 수정 작성 폼이 보인다
    const commentUpdateForm = document.querySelector(`#form-comment-update-${e.id}`)
    // 그리고 원래 내용은 안 보이게 한다
    const commentForm = document.querySelector(`.detail-comment-review-${ e.id }`)

    if (commentUpdateForm.style.display === 'none') {
      commentUpdateForm.style.display = 'block'
      commentForm.style.display = 'none'
    } else {
      commentUpdateForm.style.display = 'none'
      commentForm.style.display = 'block'
    }
  }

  const comment_update_exit = (e) => {
    // 취소를 누르면 폼을 없앤다
    const commentUpdateForm = document.querySelector(`.form-${e.id}`)
    // 취소를 누르면 원래 내용을 보여준다
    const commentForm = document.querySelector(`.review-${ e.id }`)

    commentUpdateForm.style.display = 'none'
    commentForm.style.display = 'block'
  }
</script>
{% endblock body %}